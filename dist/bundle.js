(()=>{"use strict";var e={970:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ASSETS_DIR=t.ROOT_DIR=t.FONT_TYPE_BOLD=t.FONT_TYPE_SEMIBOLD=t.FONT_TYPE_MEDIUM=t.TEXT_COLOR=t.BLANK_COLOR=t.BOTTOM_EDGE=t.LEFT_EDGE=t.TOP_EDGE=t.RIGHT_EDGE=t.BLANK_PADDING=t.BLANK_SIZE_X=t.BLANK_SIZE_Y=void 0;const o=a(r(17));t.BLANK_SIZE_Y=3508,t.BLANK_SIZE_X=2480,t.BLANK_PADDING=100,t.RIGHT_EDGE=t.BLANK_SIZE_X-t.BLANK_PADDING,t.TOP_EDGE=t.BLANK_PADDING,t.LEFT_EDGE=t.BLANK_PADDING,t.BOTTOM_EDGE=t.BLANK_SIZE_Y-t.BLANK_PADDING,t.BLANK_COLOR="#f2f2f2",t.TEXT_COLOR="#191b23",t.FONT_TYPE_MEDIUM="medium",t.FONT_TYPE_SEMIBOLD="semibold",t.FONT_TYPE_BOLD="bold",t.ROOT_DIR=o.default.resolve(__filename,".."),t.ASSETS_DIR=o.default.resolve(t.ROOT_DIR,"assets")},607:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRequestBlank=void 0;const a=r(680);var o=r(680);Object.defineProperty(t,"createRequestBlank",{enumerable:!0,get:function(){return o.createRequestBlank}}),e.exports={createRequestBlank:a.createRequestBlank}},680:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createRequestBlank=void 0;const o=a(r(441)),i=a(r(17)),_=r(970),l=r(884),s=r(124),n={from:_.TOP_EDGE,to:_.TOP_EDGE+100,type:_.TOP_EDGE+800,clarification:_.TOP_EDGE+1e3,withRespect:_.BOTTOM_EDGE-100,date:_.BOTTOM_EDGE};t.createRequestBlank=async function(e){const t=(0,s.capitalizeFirstLetter)(new Intl.DateTimeFormat("ru-RU",{dateStyle:"full"}).format(e.date)),[r,a,u,f,E,T]=await Promise.all([(0,l.processText)(`От ${e.from}`),(0,l.processText)(`Кому ${e.to}`),(0,l.processText)((0,s.capitalizeFirstLetter)(e.type),{fontFamily:_.FONT_TYPE_BOLD,svgOptions:{fontSize:100}}),(0,l.processText)(e.clarification,{multiline:{maxWidth:_.BLANK_SIZE_X-2*_.BLANK_PADDING}}),(0,l.processText)(e.withRespect||" "),(0,l.processText)(t)]),p=Number(r.meta.width)>Number(a.meta.width)?Number(r.meta.width):Number(a.meta.width),c=await(0,o.default)(i.default.resolve(_.ASSETS_DIR,"images/arms.png")).resize(2e3,2e3).toBuffer(),d=await(0,o.default)(i.default.resolve(_.ASSETS_DIR,"images/main_stamp.png")).toBuffer();return await(0,o.default)({create:{width:_.BLANK_SIZE_X,height:_.BLANK_SIZE_Y,channels:4,background:_.BLANK_COLOR}}).composite([{input:c},{input:d,top:_.BOTTOM_EDGE-950-50,left:_.RIGHT_EDGE-950-50},{input:r.buffer,top:n.from,left:Math.floor(_.RIGHT_EDGE-p)},{input:a.buffer,top:n.to,left:Math.floor(_.RIGHT_EDGE-p)},{input:u.buffer,top:n.type,left:Math.floor(_.RIGHT_EDGE/2-Number(u.meta.width)/2)},{input:f.buffer,top:n.clarification,left:_.LEFT_EDGE},{input:E.buffer,top:Math.floor(n.withRespect-Number(E.meta.height)),left:_.LEFT_EDGE},{input:T.buffer,top:Math.floor(n.date-Number(T.meta.height)),left:_.LEFT_EDGE}])}},124:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.capitalizeFirstLetter=void 0,t.capitalizeFirstLetter=e=>e.charAt(0).toUpperCase()+e.slice(1)},884:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.processText=t.TTSVG=void 0;const o=a(r(441)),i=a(r(17)),_=r(970),l=r(882);t.TTSVG={[_.FONT_TYPE_MEDIUM]:l.loadSync(i.default.resolve(_.ASSETS_DIR,"fonts/OpenSans-Medium.ttf")),[_.FONT_TYPE_SEMIBOLD]:l.loadSync(i.default.resolve(_.ASSETS_DIR,"fonts/OpenSans-SemiBold.ttf")),[_.FONT_TYPE_BOLD]:l.loadSync(i.default.resolve(_.ASSETS_DIR,"fonts/OpenSans-Bold.ttf"))};const s={x:0,y:0,fontSize:80,anchor:"top",attributes:{fill:_.TEXT_COLOR,stroke:"transparent",kek:"mek"}};t.processText=async(e,r={})=>{const{fontFamily:a=_.FONT_TYPE_MEDIUM,svgOptions:i={},multiline:l={}}=r,n=t.TTSVG[a];let u=Buffer.from(n.getSVG(e,{...s,...i})),f=(0,o.default)(u),E=await f.metadata();const T=Number(E.width);if(l.maxWidth&&T>l.maxWidth){const{maxWidth:t}=l,r=((e,t,r)=>{var a=t/e.length;let o=[],i=0;for(var _=0;_<Math.ceil(t/r);_++){let t="",_=0;for(;!(_>r)&&e[i];)t+=e[i],i++,_+=a;o.push(t.trim())}return o.filter(Boolean)})(e,T,t),a=Number(E.height),_=r.length;if(!r)throw new Error("Could not split text for multiple lines");const p=r.map(((e,t)=>({input:Buffer.from(n.getSVG(e,{...s,...i})),left:0,top:a*t})));f=(0,o.default)({create:{height:a*_,width:t+100,channels:4,background:{r:255,g:255,b:255,alpha:0}}}).composite(p).png(),E=await f.metadata(),u=await f.clone().toBuffer()}return{image:f,buffer:u,meta:E}}},441:e=>{e.exports=require("sharp")},882:e=>{e.exports=require("text-to-svg")},17:e=>{e.exports=require("path")}},t={},r=function r(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,r),i.exports}(607),a=exports;for(var o in r)a[o]=r[o];r.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();